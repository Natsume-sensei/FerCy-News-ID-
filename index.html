<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0B0E14">
    
    <title>FerCy News ID Portal</title>
    <meta name="description" content="Portal Berita Lingkungan dan Teknologi Terkini" id="metaDesc">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2DR1RPLE8D"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-2DR1RPLE8D');
    </script>

    <meta property="og:type" content="article" />
    <meta property="og:site_name" content="FerCy News ID" />
    <meta property="og:title" content="FerCy News ID Portal" id="ogTitle" />
    <meta property="og:description" content="Portal Berita Lingkungan dan Teknologi Terkini" id="ogDesc" />
    <meta property="og:image" content="https://cdn-icons-png.flaticon.com/512/2965/2965879.png" id="ogImage" />
    <meta property="og:url" content="" id="ogUrl" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="FerCy News ID Portal" id="twTitle" />
    <meta name="twitter:description" content="Portal Berita Lingkungan dan Teknologi Terkini" id="twDesc" />
    <meta name="twitter:image" content="https://cdn-icons-png.flaticon.com/512/2965/2965879.png" id="twImage" />
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google-site-verification" content="Qfw1aaIZxmugFbdwbjXDkxXDwSWf5Aj4ONqqR9a47s4" />
    
    <link rel="manifest" id="my-manifest-placeholder">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

    <style>
        /* --- WEB3 / FUTURISTIC VARIABLES --- */
        :root {
            /* Web3 Palette: Deep Space & Neon */
            --bg-body: #05050a;         /* Void Black */
            --bg-card: rgba(20, 20, 35, 0.6); /* Semi-transparent Glass */
            --bg-card-hover: rgba(30, 30, 50, 0.8);
            
            --primary: #6366f1;         /* Indigo Neon */
            --secondary: #06b6d4;       /* Cyan Neon */
            --accent: #d946ef;          /* Fuchsia Neon */
            --success: #10b981;         /* Emerald Neon */
            --danger: #ef4444;          /* Red Neon */
            
            --text-main: #e2e8f0;       /* Off-white */
            --text-muted: #94a3b8;      /* Blue-grey */
            
            --border: rgba(255, 255, 255, 0.08);
            --border-hover: rgba(6, 182, 212, 0.5); /* Cyan glow border */
            
            --glass-bg: rgba(5, 5, 10, 0.7);
            --glass-blur: blur(20px);
            --glass-border: 1px solid rgba(255, 255, 255, 0.05);
            
            --glow-sm: 0 0 10px rgba(99, 102, 241, 0.3);
            --glow-md: 0 0 20px rgba(6, 182, 212, 0.4);
            --glow-text: 0 0 5px rgba(255, 255, 255, 0.5);
            
            --radius: 16px;
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            
            /* Gradient Meshes */
            --gradient-1: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            --gradient-2: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
        }

        /* --- LIGHT MODE (Re-imagined as "Clean Futurism") --- */
        body.light-mode {
            --bg-body: #f8fafc;
            --bg-card: #ffffff;
            --bg-card-hover: #f1f5f9;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --glass-bg: rgba(255, 255, 255, 0.85);
            --border-hover: #6366f1;
        }

        /* --- RESET & BASE --- */
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        html { scroll-behavior: smooth; }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            /* Abstract Background Mesh */
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(99, 102, 241, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(6, 182, 212, 0.15) 0%, transparent 40%);
            background-attachment: fixed;
            color: var(--text-main);
            margin: 0; padding: 0;
            line-height: 1.6;
            transition: var(--transition);
            overflow-x: hidden;
        }

        /* Tech Typography */
        h1, h2, h3, h4, .logo, .ticker-heading, .card-cat, .badge { 
            font-family: 'Space Grotesk', sans-serif; 
            letter-spacing: -0.02em;
        }
        
        a { text-decoration: none; color: inherit; transition: var(--transition); }
        ul { list-style: none; padding: 0; margin: 0; }

        /* --- HEADER (GLASS HUD STYLE) --- */
        header {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border-bottom: var(--glass-border);
            padding: 1rem 0;
            position: sticky; 
            top: 0; 
            z-index: 1000;
        }
        
        .header-inner {
            max-width: 1400px; margin: 0 auto; padding: 0 24px;
            display: flex; justify-content: space-between; align-items: center;
        }
        
        .logo {
            font-size: 1.8rem; font-weight: 700; color: var(--text-main);
            display: flex; align-items: center; gap: 12px; cursor: pointer;
            text-shadow: var(--glow-text);
        }
        .logo i { 
            background: var(--gradient-2); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 5px rgba(6, 182, 212, 0.5));
        }
        .logo span { 
            background: var(--gradient-1);
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent;
        }
        
        .nav-tools { display: flex; align-items: center; gap: 15px; }

        #adminBtn { display: none; } 

        /* --- BUTTONS (NEON STYLE) --- */
        .btn {
            padding: 0.7rem 1.4rem; border-radius: 12px; font-weight: 600; font-size: 0.9rem;
            border: 1px solid transparent; cursor: pointer; transition: var(--transition); 
            display: inline-flex; align-items: center; gap: 8px;
            font-family: 'Space Grotesk', sans-serif;
            position: relative; overflow: hidden;
        }
        
        .btn-primary { 
            background: rgba(99, 102, 241, 0.1); 
            border-color: var(--primary); 
            color: var(--primary); 
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.1);
        }
        .btn-primary:hover { 
            background: var(--primary); 
            color: #fff; 
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.6); 
            transform: translateY(-2px);
        }
        
        .btn-outline { 
            background: transparent; border: 1px solid var(--border); color: var(--text-muted); 
        }
        .btn-outline:hover { 
            border-color: var(--secondary); color: var(--secondary); 
            background: rgba(6, 182, 212, 0.05); 
            box-shadow: var(--glow-sm);
        }
        
        .btn-ai {
            background: var(--gradient-1);
            color: white;
            border: none;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
        }
        .btn-ai:hover {
            filter: brightness(1.2);
            box-shadow: 0 0 25px rgba(139, 92, 246, 0.7);
        }
        
        /* Specialized Buttons */
        .btn-danger { background: rgba(239, 68, 68, 0.1); border: 1px solid var(--danger); color: var(--danger); }
        .btn-danger:hover { background: var(--danger); color: white; box-shadow: 0 0 15px var(--danger); }
        
        .btn-success { background: rgba(16, 185, 129, 0.1); border: 1px solid var(--success); color: var(--success); }
        .btn-warning { background: rgba(245, 158, 11, 0.1); border: 1px solid var(--accent); color: var(--accent); }

        .ai-tools-container {
            display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;
        }

        /* --- TICKER (CYBERPUNK STYLE) --- */
        .ticker-wrap {
            background: rgba(0, 0, 0, 0.3);
            border-bottom: 1px solid var(--border);
            color: var(--text-main);
            font-size: 0.9rem;
            display: flex; align-items: stretch; overflow: hidden; height: 45px;
            backdrop-filter: blur(5px);
        }
        .ticker-heading {
            background: var(--danger); 
            padding: 0 25px; display: flex; align-items: center;
            font-weight: 700; text-transform: uppercase; letter-spacing: 1px; flex-shrink: 0;
            position: relative; z-index: 2;
            color: #fff;
            clip-path: polygon(0 0, 100% 0, 90% 100%, 0% 100%); /* Tech Shape */
            padding-right: 40px;
        }
        .ticker-move {
            display: flex; align-items: center; white-space: nowrap;
            animation: ticker 35s linear infinite; padding-left: 20px;
        }
        .ticker-wrap:hover .ticker-move { animation-play-state: paused; }
        .ticker-item { margin-right: 50px; cursor: pointer; opacity: 0.8; transition: 0.3s; }
        .ticker-item:hover { color: var(--secondary); opacity: 1; text-shadow: 0 0 10px var(--secondary); }
        @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

        /* --- LAYOUT GRID --- */
        .container {
            max-width: 1400px; margin: 40px auto; padding: 0 24px;
            display: grid; grid-template-columns: 320px 1fr; gap: 40px;
            align-items: start; min-height: 80vh;
        }

        /* --- SIDEBAR (HUD) --- */
        aside { position: sticky; top: 110px; }
        
        .sidebar-section {
            background: var(--bg-card); 
            border: 1px solid var(--border);
            border-radius: var(--radius); padding: 1.5rem; margin-bottom: 2rem;
            backdrop-filter: blur(10px);
            transition: var(--transition);
        }
        .sidebar-section:hover {
            border-color: rgba(99, 102, 241, 0.3);
            box-shadow: var(--glow-sm);
        }

        .sidebar-section h3 {
            margin-top: 0; padding-bottom: 1rem; border-bottom: 1px solid var(--border);
            font-size: 1rem; color: var(--secondary); text-transform: uppercase; letter-spacing: 1.5px;
            display: flex; align-items: center; gap: 10px;
        }
        
        .cat-item {
            display: flex; justify-content: space-between; padding: 12px 10px;
            border-bottom: 1px solid var(--border); cursor: pointer; color: var(--text-muted); font-size: 0.95rem;
            transition: var(--transition); border-radius: 8px; margin-bottom: 4px;
        }
        .cat-item:hover { 
            color: var(--text-main); background: rgba(255, 255, 255, 0.03); padding-left: 15px; 
            border-left: 2px solid var(--secondary);
        }
        .cat-item.active-menu { 
            color: #fff; background: var(--gradient-1); 
            border: none; padding-left: 15px; font-weight: 600; 
            box-shadow: var(--glow-sm);
        }
        
        .search-box {
            width: 100%; padding: 14px 20px; border-radius: 12px; 
            border: 1px solid var(--border);
            background: rgba(0,0,0,0.2); color: var(--text-main); 
            transition: var(--transition); margin-bottom: 25px;
            font-family: 'Inter', sans-serif;
        }
        .search-box:focus { 
            border-color: var(--primary); 
            background: rgba(0,0,0,0.4);
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2); 
        }

        .tag-cloud { display: flex; flex-wrap: wrap; gap: 8px; }
        .tag {
            background: rgba(255, 255, 255, 0.05); color: var(--text-muted);
            padding: 6px 14px; border-radius: 50px; font-size: 0.75rem; font-weight: 500; cursor: pointer;
            transition: var(--transition); border: 1px solid transparent;
        }
        .tag:hover { 
            border-color: var(--secondary); color: var(--secondary); 
            background: rgba(6, 182, 212, 0.1); 
            box-shadow: 0 0 10px rgba(6, 182, 212, 0.2);
        }

        /* --- SMART WIDGET (HOLOGRAPHIC) --- */
        .smart-widget {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5);
            margin-bottom: 2rem;
            position: relative;
            backdrop-filter: blur(15px);
        }
        /* Holographic sheen */
        .smart-widget::after {
            content: ''; position: absolute; top:0; left:0; right:0; height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        }

        .sw-tabs {
            display: flex; background: rgba(0,0,0,0.2); padding: 5px; gap: 5px;
        }
        .sw-tab-btn {
            flex: 1; padding: 10px; text-align: center; border-radius: 12px;
            font-size: 0.85rem; font-weight: 600; cursor: pointer;
            color: var(--text-muted); transition: var(--transition);
        }
        .sw-tab-btn.active {
            background: rgba(255, 255, 255, 0.1); color: var(--text-main);
            box-shadow: inset 0 0 0 1px rgba(255,255,255,0.05);
        }

        .sw-content { display: none; animation: fadeIn 0.4s ease; padding: 0; }
        .sw-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .local-weather-card { padding: 2rem 1.5rem; position: relative; }
        .lw-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .lw-location { font-size: 1.2rem; font-weight: 700; display: flex; align-items: center; gap: 8px; color: var(--text-main); }
        .lw-main { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem; }
        .lw-temp { font-size: 3.5rem; font-weight: 700; line-height: 1; background: var(--gradient-2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .lw-desc { font-size: 1rem; color: var(--text-muted); text-transform: capitalize; margin-top: 5px; }
        
        .lw-aqi-badge {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            padding: 8px 16px; border-radius: 12px; text-align: center;
        }
        .lw-aqi-val { font-size: 1.5rem; font-weight: 700; color: var(--success); }
        .lw-aqi-lbl { font-size: 0.7rem; text-transform: uppercase; opacity: 0.7; }

        .lw-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
            background: rgba(0,0,0,0.2); padding: 12px; border-radius: 12px;
        }
        .lw-item { display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 0.85rem; color: var(--text-muted); }

        .global-list { padding: 1.5rem; max-height: 350px; overflow-y: auto; }
        .gl-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px 15px; margin-bottom: 8px;
            background: rgba(255,255,255,0.03); border: 1px solid transparent;
            border-radius: 12px; transition: 0.2s;
        }
        .gl-item:hover { border-color: var(--primary); background: rgba(99, 102, 241, 0.05); }
        .gl-city { font-weight: 700; font-size: 1rem; }
        .gl-time { font-family: 'Space Grotesk', monospace; opacity: 0.7; font-size: 0.8rem; }
        .gl-weather { font-size: 1.1rem; color: var(--secondary); display: flex; align-items: center; gap: 5px; }

        /* --- ARTICLES (BENTO GRID) --- */
        .articles-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 24px;
        }
        @media (min-width: 1024px) {
            .article-card-container:first-child { 
                grid-column: 1 / -1; 
                height: 500px; 
            }
            .article-card-container:first-child .card-title { font-size: 2.5rem; text-shadow: 0 4px 8px rgba(0,0,0,0.8); }
        }

        /* --- CARD STYLES (GLASS & NEON) --- */
        .article-card-container {
            height: 420px; position: relative; perspective: none;
            border-radius: 20px; overflow: hidden;
            background: var(--bg-card); 
            border: 1px solid var(--border);
            transition: var(--transition);
        }
        
        /* Breaking News Neon Border */
        .article-card-container.breaking-news {
            border: 1px solid var(--danger);
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.2);
        }
        .breaking-badge {
            position: absolute; top: 15px; right: 15px; 
            background: var(--danger); color: white;
            padding: 4px 10px; border-radius: 6px; font-weight: 700; font-size: 0.7rem; z-index: 5;
            box-shadow: 0 0 10px var(--danger); animation: flash 2s infinite;
        }
        @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }

        /* Hover Effect */
        .article-card-container:hover { 
            transform: translateY(-5px); 
            border-color: var(--secondary);
            box-shadow: var(--glow-md);
            z-index: 5;
        }
        
        .article-card { width: 100%; height: 100%; position: relative; display: flex; flex-direction: column; }
        
        .card-front { position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; z-index: 1; }
        .card-img { height: 220px; width: 100%; object-fit: cover; transition: transform 0.5s ease; opacity: 0.9; }
        
        .article-card-container:first-child .card-img { height: 100%; position: absolute; top: 0; left: 0; filter: brightness(0.6); }
        .article-card-container:first-child .card-content { 
            position: absolute; bottom: 0; left: 0; width: 100%; 
            background: linear-gradient(to top, #05050a 10%, transparent); 
            z-index: 2; padding: 2.5rem; border-top: none;
        }
        
        .article-card-container:hover .card-img { transform: scale(1.05); }
        
        .card-content { 
            padding: 1.5rem; flex: 1; display: flex; flex-direction: column; position: relative; 
            background: linear-gradient(to bottom, var(--bg-card), rgba(0,0,0,0.8));
            border-top: 1px solid var(--border);
        }
        .article-card-container:first-child .card-content { background: linear-gradient(to top, black, transparent); } 

        .card-cat { 
            color: var(--secondary); font-weight: 700; font-size: 0.75rem; 
            text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; display: block; 
            text-shadow: 0 0 5px rgba(6, 182, 212, 0.4);
        }
        
        .btn-bookmark-absolute {
            position: absolute; top: 15px; right: 15px; z-index: 20; 
            background: rgba(0,0,0,0.5); backdrop-filter: blur(5px);
            border: 1px solid var(--border); cursor: pointer; color: var(--text-muted); 
            width: 36px; height: 36px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            transition: 0.2s;
        }
        .article-card-container.breaking-news .btn-bookmark-absolute { right: auto; left: 15px; }
        .btn-bookmark-absolute:hover, .btn-bookmark-absolute.active { 
            color: var(--accent); border-color: var(--accent); background: rgba(0,0,0,0.8); box-shadow: 0 0 10px var(--accent);
        }

        .card-title { 
            font-size: 1.2rem; font-weight: 700; margin: 0 0 1rem 0; line-height: 1.3; 
            color: var(--text-main); display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; 
        }
        .card-meta { 
            margin-top: auto; display: flex; justify-content: space-between; align-items: center; 
            font-size: 0.8rem; color: var(--text-muted); border-top: 1px dashed var(--border); padding-top: 1rem; 
        }
        
        /* Card Back (Reveal on Hover) */
        .card-back { 
            position: absolute; bottom: 0; left: 0; width: 100%; height: auto; 
            background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(20px); 
            padding: 2rem; z-index: 10; transform: translateY(100%); 
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1); 
            display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; 
            border-top: 2px solid var(--secondary); 
        }
        .article-card-container:hover .card-back { transform: translateY(0); }

        /* --- SKELETON --- */
        .skeleton { background: rgba(255,255,255,0.05); animation: pulse 1.5s infinite ease-in-out; border-radius: 8px; }
        .skeleton-card { height: 400px; display: flex; flex-direction: column; background: var(--bg-card); border-radius: var(--radius); overflow: hidden; border: 1px solid var(--border); }
        .skeleton-img { height: 200px; background: rgba(255,255,255,0.08); width: 100%; }
        .skeleton-text { height: 15px; margin: 10px 1.5rem; background: rgba(255,255,255,0.05); border-radius: 4px; }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 0.8; } 100% { opacity: 0.5; } }

        /* --- PAGINATION & SHARE --- */
        .share-buttons { display: flex; gap: 10px; margin: 1.5rem 0; }
        .share-btn { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; transition: 0.3s; font-size: 1.1rem; }
        .share-btn:hover { transform: translateY(-3px); box-shadow: 0 0 15px rgba(255,255,255,0.2); }
        .fb { background: #1877f2; } .tw { background: #1da1f2; } .wa { background: #25d366; }
        
        .pagination-container { margin-top: 3rem; display: flex; justify-content: center; align-items: center; gap: 15px; }

        /* --- MODALS (GLASS) --- */
        .modal { 
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(8px); z-index: 2000; overflow-y: auto; 
        }
        .modal-content { 
            background: #0f172a; 
            border: 1px solid var(--border);
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            margin: 50px auto; width: 90%; max-width: 900px; border-radius: 24px; 
            overflow: hidden; animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); position: relative; 
        }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .close { 
            position: absolute; right: 20px; top: 20px; width: 40px; height: 40px; 
            background: rgba(255,255,255,0.1); border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; cursor: pointer; 
            color: var(--text-main); font-size: 1.2rem; transition: var(--transition); z-index: 100; 
        }
        .close:hover { background: var(--danger); color: white; transform: rotate(90deg); }

        /* Reading View */
        .read-header { height: 400px; position: relative; }
        .read-cover { width: 100%; height: 100%; object-fit: cover; }
        .read-header::after { content: ''; position: absolute; inset: 0; background: linear-gradient(to top, #0f172a, transparent); }
        
        .read-body { padding: 0 3rem 3rem; max-width: 800px; margin: -100px auto 0; position: relative; z-index: 5; }
        .read-body h1 { font-size: 2.8rem; margin-bottom: 1.5rem; line-height: 1.1; color: var(--text-main); text-shadow: 0 0 20px rgba(0,0,0,0.5); }
        
        .read-meta { 
            font-size: 0.9rem; color: var(--text-muted); margin-bottom: 2rem; 
            border-left: 4px solid var(--secondary); padding-left: 1rem; 
            display: flex; justify-content: space-between; align-items: center; 
            background: rgba(255,255,255,0.02); padding: 1rem; border-radius: 0 12px 12px 0;
        }

        .read-content img { max-width: 100%; height: auto; border-radius: 12px; margin: 1.5rem auto; display: block; border: 1px solid var(--border); }
        
        /* AI Summary Box */
        .ai-summary-box {
            background: linear-gradient(to right, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05));
            border: 1px solid var(--primary);
            border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem;
            display: none; animation: fadeIn 0.5s; box-shadow: var(--glow-sm);
        }
        .ai-summary-box h4 { margin-top: 0; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        .speaking-animation {
            display: inline-block; width: 10px; height: 10px; background-color: var(--accent); border-radius: 50%;
            animation: pulseSpeech 1s infinite; margin-left: 10px; display: none; box-shadow: 0 0 10px var(--accent);
        }
        @keyframes pulseSpeech { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.5); opacity: 0.5; } 100% { transform: scale(1); opacity: 1; } }

        /* Reading Controls */
        .text-control-box {
            display: inline-flex; align-items: center;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border); padding: 5px 15px; border-radius: 50px;
            gap: 15px; margin-left: 10px;
        }
        .tc-btn { background: transparent; border: none; color: var(--text-muted); cursor: pointer; font-size: 1rem; display: flex; align-items: center; gap: 5px; transition: var(--transition); }
        .tc-btn:hover { color: var(--text-main); text-shadow: 0 0 5px white; }
        .tc-divider { width: 1px; background: var(--border); height: 15px; }

        /* Read Progress */
        .read-progress-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 4px; background: transparent; z-index: 2100; display: none;
        }
        .read-progress-bar {
            height: 100%; background: var(--gradient-2); width: 0%;
            box-shadow: 0 0 10px var(--secondary);
        }

        /* --- FORMS & ADMIN --- */
        .form-group { margin-bottom: 1.5rem; }
        .form-label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-muted); font-size: 0.9rem; }
        .form-input, select.form-input { 
            width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 12px; 
            background: rgba(0,0,0,0.3); color: var(--text-main); font-family: inherit; font-size: 1rem; transition: var(--transition); 
        }
        .form-input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); }
        
        .file-upload-wrapper {
            border: 2px dashed var(--border); padding: 2rem; border-radius: 12px; text-align: center; cursor: pointer; transition: 0.3s; background: rgba(255,255,255,0.02); position: relative;
        }
        .file-upload-wrapper:hover { border-color: var(--secondary); background: rgba(6, 182, 212, 0.05); }
        .file-upload-input { position: absolute; width: 100%; height: 100%; top: 0; left: 0; opacity: 0; cursor: pointer; }
        .file-upload-preview { max-height: 200px; display: none; margin: 10px auto; border-radius: 8px; box-shadow: var(--glow-sm); }
        .hidden { display: none !important; }

        /* Dashboard Stats */
        .dashboard-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { 
            background: rgba(255,255,255,0.03); border: 1px solid var(--border); padding: 20px; 
            border-radius: 16px; text-align: center; backdrop-filter: blur(10px);
        }
        .stat-number { font-size: 2.5rem; font-weight: 700; color: var(--text-main); margin: 10px 0; text-shadow: 0 0 15px rgba(255,255,255,0.2); }
        
        /* Tables */
        .admin-table-container { overflow-x: auto; }
        .admin-table { width: 100%; border-collapse: separate; border-spacing: 0; }
        .admin-table th { background: rgba(255,255,255,0.05); padding: 15px; text-align: left; font-weight: 600; border-bottom: 2px solid var(--border); color: var(--secondary); }
        .admin-table td { padding: 15px; border-bottom: 1px solid var(--border); background: rgba(255,255,255,0.01); font-size: 0.9rem; }
        
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
        .badge-published { background: rgba(16, 185, 129, 0.2); color: var(--success); border: 1px solid var(--success); }
        .badge-pending { background: rgba(245, 158, 11, 0.2); color: #fbbf24; border: 1px solid #fbbf24; }
        .badge-scheduled { background: rgba(99, 102, 241, 0.2); color: var(--primary); border: 1px solid var(--primary); }

        /* --- REAL TIME ANALYTICS (TRADING STYLE) --- */
        .rt-container { display: grid; grid-template-columns: 1fr 2fr; gap: 20px; margin-bottom: 30px; }
        .rt-card {
            background: rgba(0,0,0,0.3); border: 1px solid var(--border);
            border-radius: 16px; padding: 20px; position: relative; overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }
        .pulsing-dot { width: 10px; height: 10px; background-color: var(--danger); border-radius: 50%; box-shadow: 0 0 10px var(--danger); animation: pulse-red 2s infinite; }
        @keyframes pulse-red { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.5); } 100% { opacity: 1; transform: scale(1); } }
        
        .rt-number-big { font-size: 3.5rem; font-weight: 700; color: var(--text-main); line-height: 1; margin-bottom: 5px; font-family: 'Space Grotesk'; letter-spacing: -2px; }
        .rt-bar-container { margin-top: 15px; display: flex; align-items: flex-end; gap: 4px; height: 60px; }
        .rt-bar { flex: 1; background: var(--secondary); opacity: 0.4; transition: height 0.5s ease; border-radius: 2px 2px 0 0; box-shadow: 0 0 5px var(--secondary); }

        .rt-list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--border); font-size: 0.9rem; }
        .rt-page-count { font-family: 'Space Grotesk'; font-weight: 700; color: var(--secondary); }
        
        /* Canvas */
        .chart-container { width: 100%; height: 250px; background: rgba(0,0,0,0.3); border-radius: 12px; padding: 10px; border: 1px solid var(--border); }

        /* --- FOOTER --- */
        .site-footer { 
            background: #020205; border-top: 1px solid var(--border);
            padding: 4rem 20px 2rem; margin-top: 4rem; position: relative;
        }
        .site-footer::before {
            content: ''; position: absolute; top: -1px; left: 0; width: 100%; height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
        }
        .footer-content { max-width: 1400px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 3rem; }
        .footer-col h4 { color: var(--secondary); font-size: 1.1rem; margin-bottom: 1.5rem; text-transform: uppercase; letter-spacing: 2px; }
        .footer-links a { display: block; padding: 5px 0; color: var(--text-muted); transition: 0.2s; }
        .footer-links a:hover { color: var(--primary); transform: translateX(5px); text-shadow: 0 0 8px var(--primary); }
        
        .footer-social-share { display: flex; gap: 10px; margin-top: 1rem; }
        .footer-share-btn { width: 40px; height: 40px; border-radius: 50%; background: rgba(255,255,255,0.05); display: flex; align-items: center; justify-content: center; color: white; transition: 0.3s; }
        .footer-share-btn:hover { background: var(--secondary); transform: scale(1.1); box-shadow: 0 0 10px var(--secondary); }
        
        .copyright-bar { text-align: center; margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--border); color: #64748b; font-size: 0.85rem; user-select: none; }
        .copyright-bar:hover { color: var(--text-main); }

        /* Scroll Top */
        .scroll-top-btn {
            position: fixed; bottom: 30px; right: 30px; width: 50px; height: 50px; border-radius: 50%;
            background: var(--gradient-1); color: white; border: none; box-shadow: var(--glow-md);
            cursor: pointer; display: none; align-items: center; justify-content: center; font-size: 1.2rem; z-index: 1000; transition: var(--transition);
        }
        .scroll-top-btn:hover { transform: translateY(-5px) scale(1.1); }

        /* Quill Editor Dark Mode Override */
        .ql-toolbar { background: #e2e8f0; border-radius: 12px 12px 0 0; }
        #editor { background: #fff; color: #000; border-radius: 0 0 12px 12px; }
        
        /* Mobile */
        @media (max-width: 1024px) {
            .container { grid-template-columns: 1fr; }
            aside { position: static; order: -1; }
            .read-body { padding: 1.5rem; margin-top: 0; }
            .read-body h1 { font-size: 2rem; }
            .read-header { height: 250px; }
            .rt-container { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <header>
        <div class="header-inner">
            <div class="logo" onclick="location.reload()">
                <i class="fas fa-cube"></i> 
                FerCy<span>News ID</span>
            </div>
            <div class="nav-tools">
                <div id="google_translate_element"></div>
                <button id="themeToggle" class="btn btn-outline" title="Ganti Tema"><i class="fas fa-sun"></i></button>
                <button id="adminBtn" class="btn btn-outline" onclick="handleAdminClick()"><i class="fas fa-user-astronaut"></i> <span id="adminText">Admin</span></button>
                
                <button id="navWriteBtn" class="btn btn-primary" onclick="openWriteModal()" style="display: none;">
                    <i class="fas fa-pen-nib"></i> Tulis
                </button>
            </div>
        </div>
    </header>

    <div class="ticker-wrap">
        <div class="ticker-heading"><i class="fas fa-bolt" style="margin-right: 8px;"></i> Breaking</div>
        <div class="ticker-move" id="tickerContent"></div>
    </div>

    <div class="container">
        <aside>
            <div class="smart-widget" id="smartWidget">
                <div class="sw-tabs">
                    <div class="sw-tab-btn active" onclick="switchWidgetTab('local')">Lokal</div>
                    <div class="sw-tab-btn" onclick="switchWidgetTab('global')">Global</div>
                </div>
                
                <div id="tab-local" class="sw-content active">
                    <div class="local-weather-card">
                        <div class="lw-header">
                            <div class="lw-location"><i class="fas fa-map-marker-alt"></i> Jakarta, ID</div>
                            <div style="font-size:0.8rem; font-family:'Space Grotesk';" id="localTimeDisplay">--:--</div>
                        </div>
                        <div class="lw-main">
                            <div class="lw-temp-wrap">
                                <div class="lw-temp"><span id="smartTemp">--</span>Â°</div>
                                <div class="lw-desc" id="smartDesc">Haze</div>
                            </div>
                            <div class="lw-aqi-badge">
                                <div class="lw-aqi-val" id="smartAqi">--</div>
                                <div class="lw-aqi-lbl" id="smartAqiStatus">AQI US</div>
                            </div>
                        </div>
                        <div class="lw-grid">
                            <div class="lw-item"><i class="fas fa-wind"></i> <span id="smartWind">--</span> km/h</div>
                            <div class="lw-item"><i class="fas fa-tint"></i> <span id="smartHum">--</span>%</div>
                        </div>
                    </div>
                </div>

                <div id="tab-global" class="sw-content">
                    <div class="global-list" id="worldDataList">
                        </div>
                </div>
            </div>

            <input type="text" id="searchInput" class="search-box" placeholder="Cari topik futuristik..." onkeyup="handleSearch()">
            
            <div class="sidebar-section">
                <h3><i class="fas fa-fire-alt"></i> Trending View</h3>
                <div class="tag-cloud" id="trendingTags"></div>
            </div>

            <div class="sidebar-section">
                <h3><i class="fas fa-th-large"></i> Kategori</h3>
                <div class="cat-list" id="categoryList">
                    <div class="cat-item active-menu" onclick="filterByCategory('Semua', this)"><span>Semua Berita</span> <i class="fas fa-chevron-right"></i></div>
                    <div class="cat-item" onclick="filterByCategory('Tersimpan', this)"><span style="color:var(--accent)"><i class="fas fa-bookmark"></i> Tersimpan</span> <i class="fas fa-chevron-right"></i></div>
                    
                    <div class="cat-item" onclick="filterByCategory('Sains', this)"><span>Sains</span> <i class="fas fa-chevron-right"></i></div>
                    <div class="cat-item" onclick="filterByCategory('Teknologi', this)"><span>Teknologi</span> <i class="fas fa-chevron-right"></i></div>
                    <div class="cat-item" onclick="filterByCategory('Lingkungan', this)"><span>Lingkungan</span> <i class="fas fa-chevron-right"></i></div>
                    <div class="cat-item" onclick="filterByCategory('Sosial', this)"><span>Sosial</span> <i class="fas fa-chevron-right"></i></div>
                    <div class="cat-item" onclick="filterByCategory('Ekonomi', this)"><span>Ekonomi</span> <i class="fas fa-chevron-right"></i></div>
                    <div class="cat-item" onclick="filterByCategory('Hukum', this)"><span>Hukum</span> <i class="fas fa-chevron-right"></i></div>
                    <div class="cat-item" onclick="filterByCategory('Politik', this)"><span>Politik</span> <i class="fas fa-chevron-right"></i></div>
                    <div class="cat-item" onclick="filterByCategory('Pendidikan', this)"><span>Pendidikan</span> <i class="fas fa-chevron-right"></i></div>
                    <div class="cat-item" onclick="filterByCategory('Bisnis', this)"><span>Bisnis</span> <i class="fas fa-chevron-right"></i></div>
                    <div class="cat-item" onclick="filterByCategory('STEAM/STEM', this)"><span>STEAM/STEM</span> <i class="fas fa-chevron-right"></i></div>
                    <div class="cat-item" onclick="filterByCategory('Seni dan Animasi', this)"><span>Seni dan Animasi</span> <i class="fas fa-chevron-right"></i></div>
                    <div class="cat-item" onclick="filterByCategory('Infografik', this)"><span>Infografik</span> <i class="fas fa-chevron-right"></i></div>
                </div>
            </div>
        </aside>

        <main>
            <div class="articles-grid" id="articlesGrid">
                </div>
            <div class="pagination-container" id="paginationControls"></div>
        </main>
    </div>

    <button onclick="scrollToTop()" class="scroll-top-btn" id="scrollTopBtn" title="Ke Atas"><i class="fas fa-arrow-up"></i></button>

    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-col">
                <div class="logo" style="margin-bottom: 1rem;"><i class="fas fa-cube"></i> FerCy<span>News ID</span></div>
                <p style="opacity: 0.7; font-size: 0.9rem;">Menyajikan jurnalisme berkualitas dengan visi masa depan. Sumber informasi utama untuk Sains, Teknologi Web3, dan Lingkungan.</p>
            </div>
            <div class="footer-col">
                <h4>Redaksi</h4>
                <div class="footer-links">
                    <a href="javascript:void(0)" onclick="openPedomanModal()">Pedoman Media Siber</a>
                    <a href="#">Tentang Kami</a>
                    <a href="#">Kode Etik Jurnalistik</a>
                    <a href="#">Karir</a>
                </div>
            </div>
            <div class="footer-col">
                <h4>Hubungi Kami</h4>
                <div class="footer-links">
                    <a href="#">+62 895-3589-84126 (WA Only)</a>
                </div>
                <div class="footer-social-share">
                    <a href="#" class="footer-share-btn"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="footer-share-btn"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="footer-share-btn"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="footer-share-btn"><i class="fab fa-linkedin-in"></i></a>
                </div>
            </div>
        </div>
        <div class="copyright-bar" ondblclick="enableAdminMode()" title="Double Click for Admin">&copy; 2025 FerCy News ID Group. All Rights Reserved.</div>
    </footer>

    <div id="writeModal" class="modal">
        <div class="modal-content form-content">
            <span class="close" onclick="closeWriteModal()">&times;</span>
            <div style="padding: 2rem;">
                <h2 id="modalTitle" style="margin-top:0; border-bottom:1px solid var(--border); padding-bottom:1rem; color:var(--text-main);"><i class="fas fa-edit"></i> Kontribusi Artikel</h2>
                <form id="articleForm" onsubmit="submitArticle(event)">
                    <input type="hidden" id="postId">
                    <input type="hidden" id="targetStatus" value="pending">

                    <div class="form-group">
                        <label class="form-label">Judul Artikel</label>
                        <input type="text" id="postTitle" class="form-input" required placeholder="Judul yang menarik perhatian...">
                    </div>
                    <div class="form-group checkbox-group" style="display:flex; align-items:center; gap:10px;">
                        <input type="checkbox" id="postIsBreaking" style="width:20px; height:20px;">
                        <label for="postIsBreaking" style="color:var(--danger); font-weight:700;">Set as BREAKING NEWS</label>
                    </div>

                    <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div>
                            <label class="form-label">Nama Penulis</label>
                            <input type="text" id="postAuthor" class="form-input" required>
                        </div>
                        <div>
                            <label class="form-label">Kategori</label>
                            <select id="postCategory" class="form-input">
                                <option>Sains</option>
                                <option>Teknologi</option>
                                <option>Lingkungan</option>
                                <option>Sosial</option>
                                <option>Ekonomi</option>
                                <option>Hukum</option>
                                <option>Politik</option>
                                <option>Masyarakat</option>
                                <option>Pendidikan</option>
                                <option>Pertahanan dan Keamanan</option>
                                <option>Bisnis</option>
                                <option>STEAM/STEM</option>
                                <option>Seni dan Animasi</option>
                                <option>Olahraga</option>
                                <option>Infografik</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Jadwal Publikasi (Opsional)</label>
                        <input type="datetime-local" id="postSchedule" class="form-input" style="color:var(--text-main);">
                        <small style="color:var(--text-muted)">Biarkan kosong untuk publikasi langsung (setelah approve).</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Cover Artikel</label>
                        
                        <div style="display:flex; gap:10px; margin-bottom:10px;">
                            <button type="button" class="btn btn-outline" onclick="toggleImageInput('upload')"><i class="fas fa-upload"></i> Upload</button>
                            <button type="button" class="btn btn-outline" onclick="toggleImageInput('url')"><i class="fas fa-link"></i> Gunakan URL</button>
                        </div>

                        <div id="imgInputUpload" class="file-upload-wrapper">
                            <i class="fas fa-cloud-upload-alt" style="font-size:2rem; color:var(--text-muted);"></i>
                            <p style="margin:5px 0;">Klik atau Seret Gambar ke sini</p>
                            <input type="file" id="coverUpload" class="file-upload-input" accept="image/*" onchange="previewImage(this)">
                            <img id="imagePreview" class="file-upload-preview">
                        </div>

                        <div id="imgInputUrl" class="hidden">
                            <input type="url" id="postImage" class="form-input" placeholder="https://...">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Tags (Pisahkan dengan koma)</label>
                        <input type="text" id="postTags" class="form-input" placeholder="#inovasi, #masaDepan">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Isi Berita</label>
                        <div id="editor" style="height: 300px;"></div>
                    </div>
                    
                    <div id="userButtons" style="margin-top: 2rem;">
                        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1rem; justify-content: center;">Submit Artikel</button>
                    </div>

                    <div id="adminButtons" style="display: flex; gap: 10px; margin-top: 2rem; display: none;">
                        <button type="submit" class="btn btn-warning" style="flex: 1; padding: 1rem; justify-content: center;" onclick="setTargetStatus('pending')">
                            <i class="fas fa-file-alt"></i> Simpan Draft
                        </button>
                        <button type="submit" class="btn btn-success" style="flex: 1; padding: 1rem; justify-content: center;" onclick="setTargetStatus('published')">
                            <i class="fas fa-check"></i> Publikasikan / Jadwalkan
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="readModal" class="modal" onscroll="updateReadProgress()">
        
        <div class="read-progress-container" id="readProgressBar">
            <div class="read-progress-bar" id="progressBarFill"></div>
        </div>

        <div class="modal-content">
            <span class="close" onclick="closeReadModal()">&times;</span>
            <div id="readContentContainer"></div>
        </div>
        </div>

    <div id="pedomanModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePedomanModal()">&times;</span>
            <div class="read-body" style="margin-top: 50px;">
                <h1 style="text-align:center; margin-bottom: 2rem;">Pedoman Pemberitaan Media Siber</h1>
                <div class="ql-editor" style="text-align: justify;"><p>Kemerdekaan berpendapat, kemerdekaan berekspresi, dan kemerdekaan pers adalah hak asasi manusia yang dilindungi Pancasila, Undang-Undang Dasar 1945, dan Deklarasi Universal Hak Asasi Manusia PBB.</p></div>
            </div>
        </div>
    </div>

    <div id="loginModal" class="modal">
        <div class="modal-content" style="max-width: 400px; text-align: center; padding: 3rem; margin-top: 15%;">
            <span class="close" onclick="closeLoginModal()">&times;</span>
            <h2><i class="fas fa-shield-alt" style="color:var(--secondary)"></i> Login Admin</h2>
            <div class="form-group" style="margin-top: 2rem;">
                <input type="password" id="adminPassword" class="form-input" placeholder="Masukkan Password Admin...">
            </div>
            <button class="btn btn-primary" onclick="verifyAdmin()" style="width:100%; justify-content: center;">Masuk Dashboard</button>
        </div>
    </div>

    <div id="adminDashboardModal" class="modal">
        <div class="modal-content admin-dashboard" style="max-width: 1200px; padding: 2rem;">
            <span class="close" onclick="closeAdminDashboard()">&times;</span>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <h2><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h2>
                <button class="btn btn-danger" onclick="bulkDeleteArticles()"><i class="fas fa-trash"></i> Hapus Terpilih</button>
            </div>
            
            <div class="dashboard-stats">
                <div class="stat-card">
                    <h3>Total Artikel</h3>
                    <div class="stat-number" id="totalArticlesCount">0</div>
                    <p class="badge badge-published">Published & Draft</p>
                </div>
                <div class="stat-card">
                    <h3>Menunggu Review</h3>
                    <div class="stat-number" id="pendingArticlesCount" style="color:var(--accent)">0</div>
                    <p class="badge badge-pending">Perlu Tindakan</p>
                </div>
                <div class="stat-card">
                    <h3>Terjadwal</h3>
                    <div class="stat-number" id="scheduledArticlesCount" style="color:var(--primary)">0</div>
                    <p class="badge badge-scheduled">Akan Terbit</p>
                </div>
            </div>

            <div style="margin-bottom: 2rem;">
                <h3><i class="fas fa-satellite-dish" style="color:var(--danger)"></i> Google Analytics Real-Time</h3>
                <div class="rt-container">
                    <div class="rt-card">
                        <div class="rt-active-header">
                            <div style="font-weight:700;">PENGGUNA AKTIF SAAT INI</div>
                            <div class="pulsing-dot"></div>
                        </div>
                        <div class="rt-number-big" id="rtActiveUsers">0</div>
                        <div class="rt-subtitle">di seluruh situs web</div>
                        
                        <div class="rt-bar-container">
                            <div class="rt-bar" style="height:30%"></div>
                            <div class="rt-bar" style="height:50%"></div>
                            <div class="rt-bar" style="height:80%"></div>
                            <div class="rt-bar" style="height:40%"></div>
                            <div class="rt-bar" style="height:60%"></div>
                            <div class="rt-bar" style="height:90%"></div>
                            <div class="rt-bar" style="height:70%"></div>
                            <div class="rt-bar" style="height:45%"></div>
                        </div>
                        <div style="font-size:0.75rem; color:var(--text-muted); text-align:right; margin-top:5px;">Per menit (30 min terakhir)</div>
                    </div>

                    <div class="rt-card">
                        <h4 style="margin-top:0;">Halaman Terpopuler (Live)</h4>
                        <div id="rtPageList">
                            </div>
                    </div>
                </div>
            </div>
            <div style="margin-bottom: 2rem;">
                <h3><i class="fas fa-chart-area"></i> Analitik Historis (Views)</h3>
                <div class="chart-container">
                    <canvas id="viewsChart" width="1000" height="250"></canvas>
                </div>
            </div>

            <div class="admin-table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th width="5%"><input type="checkbox" onchange="toggleSelectAll(this)"></th>
                            <th width="35%">Judul Artikel</th>
                            <th width="15%">Penulis</th>
                            <th width="10%">Kategori</th>
                            <th width="10%">Status</th>
                            <th width="10%">Jadwal/Tgl</th>
                            <th width="15%">Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="adminTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script type="text/javascript">
        function googleTranslateElementInit() { new google.translate.TranslateElement({ pageLanguage: 'id', layout: google.translate.TranslateElement.InlineLayout.SIMPLE, autoDisplay: false }, 'google_translate_element'); }
    </script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // --- FEATURE: MANIFEST & PWA (TAHAP 2: Service Worker Optimized) ---
        const manifestData = {
            "name": "FerCy News ID",
            "short_name": "FerCy News",
            "start_url": ".",
            "display": "standalone",
            "background_color": "#0f172a",
            "theme_color": "#0f172a",
            "icons": [{ "src": "https://cdn-icons-png.flaticon.com/512/2965/2965879.png", "sizes": "512x512", "type": "image/png" }]
        };
        const blob = new Blob([JSON.stringify(manifestData)], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(blob);
        document.querySelector('#my-manifest-placeholder').setAttribute('href', manifestURL);

        // --- KONFIGURASI FIREBASE ---
        const firebaseConfig = {
             apiKey: "AIzaSyCMHXlhtTu9n9RDXWdS9XZZvszHa0bx5d4",
             authDomain: "fercy-news-id.firebaseapp.com",
             databaseURL: "https://fercy-news-id-default-rtdb.firebaseio.com",
             projectId: "fercy-news-id",
             appId: "1:178410341706:web:f9be18a4931e1e0c3a6db3"
        };

        if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
        const db = firebase.database();
        const articlesRef = db.ref('articles');

        let articles = []; 

        const defaultArticles = [
            { id: 1, title: "Revolusi Hijau: Kota Masa Depan", author: "Sarah Wijaya", date: "2025-10-12", category: "Lingkungan", image: "https://images.unsplash.com/photo-1518005052357-e9847508d571?auto=format&fit=crop&w=800&q=80", tags: ["#EcoCity"], status: 'published', views: 120, isBreaking: false, content: "<h3>Kota Ramah Lingkungan</h3><p>Kota masa depan...</p>" },
            { id: 2, title: "AI Generatif dan Etika Digital", author: "Budi Santoso", date: "2025-11-05", category: "Teknologi", image: "https://images.unsplash.com/photo-1677442136019-21780ecad995?auto=format&fit=crop&w=800&q=80", tags: ["#AI"], status: 'published', views: 345, isBreaking: true, content: "<h3>Kecerdasan Buatan</h3><p>AI semakin canggih...</p>" },
            { id: 3, title: "Transformasi Pendidikan 2025", author: "Prof. Handoko", date: "2025-12-01", category: "Pendidikan", image: "https://images.unsplash.com/photo-1509062522246-3755977927d7?auto=format&fit=crop&w=800&q=80", tags: ["#Edukasi"], status: 'published', views: 89, isBreaking: false, content: "<h3>Sekolah Digital</h3><p>Belajar dari rumah...</p>" }
        ];

        // SKELETON LOADING
        function renderSkeleton() {
            const grid = document.getElementById('articlesGrid');
            let html = '';
            for(let i=0; i<6; i++) {
                html += `
                <div class="skeleton-card">
                    <div class="skeleton skeleton-img"></div>
                    <div class="card-content">
                        <div class="skeleton skeleton-text short"></div>
                        <div class="skeleton skeleton-text"></div>
                        <div class="skeleton skeleton-text"></div>
                        <div style="margin-top:auto; display:flex; justify-content:space-between;">
                            <div class="skeleton skeleton-text short"></div>
                            <div class="skeleton skeleton-text short"></div>
                        </div>
                    </div>
                </div>`;
            }
            grid.innerHTML = html;
        }
        renderSkeleton();

        // --- FIXED: MENAMBAHKAN FLAG AGAR TIDAK LOOPING ---
        let isInitialLoad = true; 

        articlesRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                articles = Object.values(data).filter(a => a && a.title);
            } else {
                defaultArticles.forEach(art => { articlesRef.child(art.id).set(art); });
                articles = defaultArticles;
            }
            
            // LOGIC FOR SCHEDULED POSTS
            const now = new Date();
            articles.forEach(art => {
                if(art.status === 'scheduled' && art.scheduledTime && new Date(art.scheduledTime) <= now) {
                    art.status = 'published';
                }
            });

            // Sort: Breaking News first, then latest
            articles.sort((a, b) => {
                if (a.isBreaking && !b.isBreaking) return -1;
                if (!a.isBreaking && b.isBreaking) return 1;
                return b.id - a.id;
            });
            refreshAllData();
            if(isAdmin) renderAdminDashboard();

            // --- FIXED: CHECK URL HANYA SAAT AWAL LOAD ---
            if (isInitialLoad) {
                const urlParams = new URLSearchParams(window.location.search);
                const articleIdFromUrl = urlParams.get('article_id');
                if (articleIdFromUrl) {
                    const targetArt = articles.find(a => a.id == articleIdFromUrl);
                    if (targetArt) { openReadArticle(articleIdFromUrl); }
                }
                isInitialLoad = false; // Matikan flag setelah check pertama
            }
        });

        // --- SMART WIDGET LOGIC ---
        function switchWidgetTab(tabName) {
            document.querySelectorAll('.sw-tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.sw-content').forEach(c => c.classList.remove('active'));
            
            if(tabName === 'local') {
                document.querySelector('.sw-tab-btn:nth-child(1)').classList.add('active');
                document.getElementById('tab-local').classList.add('active');
                // Removed explicit background set to keep CSS style
            } else {
                document.querySelector('.sw-tab-btn:nth-child(2)').classList.add('active');
                document.getElementById('tab-global').classList.add('active');
                fetchGlobalWeather(); 
            }
        }

        // Fetch Local AQI & Weather
        function fetchLocalEnv() {
            const lat = -6.2088, lon = 106.8456; 
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,wind_speed_10m,pm2_5,weather_code&timezone=auto`;

            fetch(url).then(r=>r.json()).then(data => {
                const c = data.current;
                const pm25 = c.pm2_5 || 40;
                
                // AQI Calculation
                let aqi = 0;
                if(pm25 <= 12) aqi = Math.round((50/12)*pm25);
                else if(pm25 <= 35.4) aqi = Math.round(((100-51)/(35.4-12.1))*(pm25-12.1)+51);
                else aqi = Math.round(((150-101)/(55.4-35.5))*(pm25-35.5)+101);

                // Update UI
                document.getElementById('smartTemp').innerText = Math.round(c.temperature_2m);
                document.getElementById('smartWind').innerText = Math.round(c.wind_speed_10m);
                document.getElementById('smartHum').innerText = c.relative_humidity_2m;
                document.getElementById('smartAqi').innerText = aqi;
                
                const statusEl = document.getElementById('smartAqiStatus');
                if(aqi <= 50) statusEl.innerText = "Baik";
                else if(aqi <= 100) statusEl.innerText = "Sedang";
                else statusEl.innerText = "Tidak Sehat";
            });

            // Update Clock
            setInterval(() => {
                document.getElementById('localTimeDisplay').innerText = new Date().toLocaleTimeString('id-ID', {hour:'2-digit', minute:'2-digit'});
            }, 1000);
        }

        // Global Weather
        async function fetchGlobalWeather() {
            const container = document.getElementById('worldDataList');
            // FIXED: Gunakan trim() untuk memastikan tidak ada whitespace yang dianggap konten
            if(container.innerHTML.trim() !== "") return; 

            const cities = [
                { name: "New York", lat: 40.7128, lon: -74.0060, tz: "America/New_York" },
                { name: "London", lat: 51.5074, lon: -0.1278, tz: "Europe/London" },
                { name: "Tokyo", lat: 35.6762, lon: 139.6503, tz: "Asia/Tokyo" }
            ];
            
            const promises = cities.map(city => 
                fetch(`https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&current=temperature_2m,weather_code&timezone=auto`)
                .then(res => res.json())
                .then(data => ({...city, temp: Math.round(data.current.temperature_2m), code: data.current.weather_code}))
            );

            const results = await Promise.all(promises);
            let html = '';
            results.forEach(c => {
                const time = new Date().toLocaleTimeString("en-US", {timeZone: c.tz, hour: '2-digit', minute:'2-digit'});
                html += `
                <div class="gl-item">
                    <div>
                        <div class="gl-city">${c.name}</div>
                        <div class="gl-weather"><i class="fas fa-temperature-high"></i> ${c.temp}Â°C</div>
                    </div>
                    <div class="gl-time">${time}</div>
                </div>`;
            });
            container.innerHTML = html;
        }
        
        // Init Smart Widget
        fetchLocalEnv();

        // --- GLOBAL VARIABLES ---
        const ITEMS_PER_PAGE = 9; 
        let currentPage = 1;
        let currentFilteredArticles = []; 
        let currentCategoryFilter = 'Semua';
        let isAdmin = false;

        // --- FIX: ADMIN AUTH (SESSION BASED - HILANG SAAT REFRESH) ---
        function enableAdminMode() {
            // Kita TIDAK menyimpan ke localStorage, agar hilang saat refresh.
            // Cukup tampilkan tombol di sesi ini.
            document.getElementById('adminBtn').style.display = 'inline-flex';
            alert("Mode Admin Diaktifkan! (Akan hilang saat refresh halaman)");
        }

        // Removed checkAdminDevice() on load to ensure it resets on refresh

        function handleAdminClick() { isAdmin ? openAdminDashboard() : openLoginModal(); }
        
        function verifyAdmin() {
            const pass = document.getElementById('adminPassword').value;
            if (pass === 'FerCyadmin1997!@#$%^&*()') {
                isAdmin = true;
                document.getElementById('adminText').innerText = "Dashboard";
                document.getElementById('adminBtn').classList.replace('btn-outline', 'btn-primary');
                
                // --- UPDATE: Tampilkan Tombol Tulis ---
                document.getElementById('navWriteBtn').style.display = 'inline-flex'; 
                // ---------------------------------------

                closeLoginModal(); 
                openAdminDashboard(); 
                alert("Login Berhasil! Akses Penulis Diaktifkan.");
            } else { alert("Password Salah!"); }
        }

        function openAdminDashboard() { 
            document.getElementById('adminDashboardModal').style.display = 'block'; 
            renderAdminDashboard();
            startRealTimeSimulation(); // START SIMULATION
        }
        function closeAdminDashboard() { document.getElementById('adminDashboardModal').style.display = 'none'; stopRealTimeSimulation(); }

        // --- ADMIN DASHBOARD ---
        function renderAdminDashboard() {
            document.getElementById('totalArticlesCount').innerText = articles.length;
            document.getElementById('pendingArticlesCount').innerText = articles.filter(a => a.status === 'pending').length;
            document.getElementById('scheduledArticlesCount').innerText = articles.filter(a => a.status === 'scheduled').length;

            renderAnalyticsChart();

            const tbody = document.getElementById('adminTableBody'); tbody.innerHTML = '';
            const sortedArticles = [...articles].filter(a => a && a.id).sort((a, b) => {
                if(a.status === 'pending' && b.status !== 'pending') return -1;
                if(a.status === 'scheduled' && b.status === 'published') return -1;
                return 1;
            });

            sortedArticles.forEach(art => {
                if(!art.title) return;
                let statusBadge = '';
                if(art.status === 'published') statusBadge = `<span class="badge badge-published">Published</span>`;
                else if(art.status === 'scheduled') statusBadge = `<span class="badge badge-scheduled">Scheduled</span>`;
                else statusBadge = `<span class="badge badge-pending">Pending</span>`;

                const scheduleInfo = art.scheduledTime ? `<br><small style="color:var(--text-muted)">${new Date(art.scheduledTime).toLocaleString()}</small>` : '';

                const quickPublishBtn = art.status === 'pending' ? `<button class="btn btn-success" style="padding:0.4rem;" title="Publikasi Cepat" onclick="quickPublish('${art.id}')"><i class="fas fa-check"></i></button>` : '';

                tbody.innerHTML += `
                    <tr>
                        <td><input type="checkbox" class="bulk-check" value="${art.id}"></td>
                        <td><strong>${art.title}</strong></td> <td>${art.author}</td> <td><span class="badge" style="background:#333; color:#fff">${art.category}</span></td> 
                        <td>${statusBadge}</td> 
                        <td>${art.date}${scheduleInfo}</td>
                        <td style="display:flex; gap:5px;">
                            ${quickPublishBtn}
                            <button class="btn btn-primary" style="padding:0.4rem;" title="Edit" onclick="openEditArticle('${art.id}')"><i class="fas fa-pen"></i></button>
                            <button class="btn btn-danger" style="padding:0.4rem;" title="Hapus" onclick="deleteOneArticle('${art.id}')"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>`;
            });
        }

        // --- NEW: REAL-TIME SIMULATION LOGIC ---
        // (Simulates Google Analytics Data in Client Side)
        let rtInterval = null;

        function startRealTimeSimulation() {
            if(rtInterval) return; // Prevent double interval

            const userDisplay = document.getElementById('rtActiveUsers');
            const bars = document.querySelectorAll('.rt-bar');
            
            // Initial Random Value
            let currentUsers = Math.floor(Math.random() * 100) + 120;
            userDisplay.innerText = currentUsers;
            renderTopPages(currentUsers);

            rtInterval = setInterval(() => {
                // Fluctuate users
                const change = Math.floor(Math.random() * 10) - 4; // -4 to +5
                currentUsers += change;
                if(currentUsers < 50) currentUsers = 50;
                userDisplay.innerText = currentUsers;

                // Animate bars randomly
                bars.forEach(bar => {
                    const h = Math.floor(Math.random() * 80) + 20;
                    bar.style.height = h + '%';
                });

                // Update pages sometimes
                if(Math.random() > 0.7) renderTopPages(currentUsers);

            }, 3000); // Update every 3 seconds
        }

        function stopRealTimeSimulation() {
            if(rtInterval) clearInterval(rtInterval);
            rtInterval = null;
        }

        function renderTopPages(totalUsers) {
            const listContainer = document.getElementById('rtPageList');
            // Get top 3 viewed articles
            const topArticles = articles.filter(a => a.status === 'published').slice(0, 3);
            
            let html = `
                <div class="rt-list-item">
                    <span class="rt-page-name">/ (Homepage)</span>
                    <span class="rt-page-count">${Math.floor(totalUsers * 0.4)}</span>
                </div>
            `;
            
            topArticles.forEach(a => {
                const count = Math.floor(totalUsers * (Math.random() * 0.15 + 0.05));
                html += `
                <div class="rt-list-item">
                    <span class="rt-page-name">${a.title.substring(0, 25)}...</span>
                    <span class="rt-page-count">${count}</span>
                </div>`;
            });

            listContainer.innerHTML = html;
        }
        // ----------------------------------------

        // --- ANALYTICS CHART DRAWING (Canvas) ---
        function renderAnalyticsChart() {
            const canvas = document.getElementById('viewsChart');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            const categories = ["Sains", "Tekno", "Lingk.", "Sosial", "Bisnis"];
            const dataPoints = categories.map(c => {
                const totalViews = articles.filter(a => a.category.includes(c)).reduce((acc, curr) => acc + (curr.views || 0), 0);
                return totalViews;
            });
            const maxVal = Math.max(...dataPoints, 10);

            ctx.clearRect(0, 0, width, height);
            
            const barWidth = 60;
            const gap = 80;
            const startX = 50;
            const bottomY = height - 40;

            dataPoints.forEach((val, i) => {
                const barHeight = (val / maxVal) * (height - 80);
                const x = startX + (i * (barWidth + gap));
                const y = bottomY - barHeight;

                const grad = ctx.createLinearGradient(x, bottomY, x, y);
                grad.addColorStop(0, '#06b6d4');
                grad.addColorStop(1, '#6366f1');
                ctx.fillStyle = grad;
                
                // Rounded bar trick (simple fillRect for now to keep code safe)
                ctx.fillRect(x, y, barWidth, barHeight);

                ctx.fillStyle = '#94a3b8';
                ctx.font = 'bold 14px Inter';
                ctx.textAlign = 'center';
                ctx.fillText(categories[i], x + barWidth/2, bottomY + 20);
                
                ctx.fillStyle = '#e2e8f0';
                ctx.fillText(val, x + barWidth/2, y - 10);
            });
        }

        function setTargetStatus(status) { document.getElementById('targetStatus').value = status; }

        function quickPublish(id) {
            if(confirm("Publikasikan artikel ini sekarang?")) {
                articlesRef.child(id).update({ status: 'published' })
                .then(() => alert("Berhasil dipublikasikan!"))
                .catch(err => alert("Gagal update: " + err));
            }
        }

        function openEditArticle(id) {
            const art = articles.find(a => a.id == id);
            if(!art) return;

            document.getElementById('modalTitle').innerHTML = '<i class="fas fa-edit"></i> Edit Artikel (Admin)';
            document.getElementById('postId').value = art.id;
            document.getElementById('postTitle').value = art.title;
            document.getElementById('postIsBreaking').checked = art.isBreaking || false; 
            document.getElementById('postAuthor').value = art.author;
            document.getElementById('postCategory').value = art.category;
            
            // Handle Image Load
            toggleImageInput('url'); // Default to URL view
            document.getElementById('postImage').value = art.image;
            
            document.getElementById('postTags').value = art.tags.join(', ');
            document.getElementById('postSchedule').value = art.scheduledTime || ''; 
            quill.root.innerHTML = art.content;

            if(isAdmin) {
                document.getElementById('userButtons').style.display = 'none';
                document.getElementById('adminButtons').style.display = 'flex';
            } else {
                document.getElementById('userButtons').style.display = 'block';
                document.getElementById('adminButtons').style.display = 'none';
            }
            
            document.getElementById('writeModal').style.display = 'block';
        }

        // --- NEW: UPLOAD IMAGE LOGIC ---
        let uploadedImageBase64 = null;

        function toggleImageInput(type) {
            if(type === 'upload') {
                document.getElementById('imgInputUpload').classList.remove('hidden');
                document.getElementById('imgInputUrl').classList.add('hidden');
                document.getElementById('postImage').value = ''; 
            } else {
                document.getElementById('imgInputUpload').classList.add('hidden');
                document.getElementById('imgInputUrl').classList.remove('hidden');
                uploadedImageBase64 = null;
                document.getElementById('imagePreview').style.display = 'none';
                document.getElementById('coverUpload').value = '';
            }
        }

        function previewImage(input) {
            const file = input.files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreview').src = e.target.result;
                    document.getElementById('imagePreview').style.display = 'block';
                    uploadedImageBase64 = e.target.result; // Simpan Base64
                }
                reader.readAsDataURL(file);
            }
        }

        function submitArticle(e) {
            e.preventDefault();
            
            const postId = document.getElementById('postId').value;
            let targetStatus = document.getElementById('targetStatus').value;
            
            const title = document.getElementById('postTitle').value;
            const isBreaking = document.getElementById('postIsBreaking').checked; 
            const author = document.getElementById('postAuthor').value;
            const category = document.getElementById('postCategory').value;
            
            // LOGIK GAMBAR BARU
            let imageSrc = document.getElementById('postImage').value;
            if(uploadedImageBase64) {
                imageSrc = uploadedImageBase64; 
            }
            
            if(!imageSrc) {
                alert("Mohon upload gambar cover atau masukkan URL!");
                return;
            }

            const tags = document.getElementById('postTags').value.split(',').map(t=>t.trim().startsWith('#')?t.trim():'#'+t.trim());
            const content = quill.root.innerHTML;
            const scheduleTime = document.getElementById('postSchedule').value;

            if(scheduleTime && targetStatus === 'published') {
                targetStatus = 'scheduled';
            }

            const articleData = {
                title: title, author: author, category: category, image: imageSrc, tags: tags, content: content,
                status: targetStatus,
                isBreaking: isBreaking,
                date: new Date().toISOString().split('T')[0],
                scheduledTime: scheduleTime 
            };

            if (postId) {
                articleData.id = parseInt(postId); 
                articlesRef.child(postId).update(articleData)
                .then(() => {
                    alert(`Artikel berhasil diperbarui menjadi: ${targetStatus.toUpperCase()}`);
                    closeWriteModal();
                })
                .catch((error) => { alert("Gagal update artikel: " + error.message); });
            } else {
                const newId = Date.now();
                articleData.id = newId;
                articleData.views = 0; 
                articlesRef.child(newId).set(articleData)
                .then(() => {
                    alert("Artikel Berhasil Disubmit!");
                    closeWriteModal();
                })
                .catch((error) => { alert("Gagal mengirim artikel: " + error.message); });
            }
        }

        function deleteOneArticle(id) {
            if(confirm("Hapus artikel ini permanen?")) { 
                articlesRef.child(id).remove()
                .then(() => console.log("Deleted " + id))
                .catch(e => alert("Error: " + e));
            }
        }

        function bulkDeleteArticles() {
            const checkboxes = document.querySelectorAll('.bulk-check:checked');
            if(checkboxes.length === 0) return alert("Pilih minimal satu artikel!");
            if(confirm(`Hapus ${checkboxes.length} artikel terpilih?`)) {
                checkboxes.forEach(cb => { 
                    articlesRef.child(cb.value).remove(); 
                });
            }
        }

        function toggleSelectAll(src) { document.querySelectorAll('.bulk-check').forEach(cb => cb.checked = src.checked); }

        const themeToggle = document.getElementById('themeToggle');
        if (localStorage.getItem('theme') === 'light') document.body.classList.add('light-mode');
        themeToggle.addEventListener('click', () => { 
            document.body.classList.toggle('light-mode'); 
            const isLight = document.body.classList.contains('light-mode');
            themeToggle.innerHTML = isLight ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
            localStorage.setItem('theme', isLight ? 'light' : 'dark'); 
        });

        var quill = new Quill('#editor', { theme: 'snow', modules: { toolbar: [ [{ 'header': [1, 2, 3, false] }], ['bold', 'italic', 'underline'], [{ 'align': [] }], [{ 'list': 'ordered'}, { 'list': 'bullet' }], ['link', 'image', 'video'], ['clean'] ] } });

        function refreshAllData() {
            const currentSearch = document.getElementById('searchInput').value || '';
            filterArticlesByQueryAndCategory(currentSearch, currentCategoryFilter, false); 
        }

        function getSavedArticles() {
            return JSON.parse(localStorage.getItem('savedArticles') || '[]');
        }

        function toggleBookmark(id, event) {
            if(event) event.stopPropagation();
            let saved = getSavedArticles();
            if(saved.includes(id)) {
                saved = saved.filter(s => s !== id);
                alert("Bookmark dihapus.");
            } else {
                saved.push(id);
                alert("Artikel disimpan ke Bookmark.");
            }
            localStorage.setItem('savedArticles', JSON.stringify(saved));
            refreshAllData(); 
        }

        function filterArticlesByQueryAndCategory(query, category, resetPage = true, element = null) {
            if(resetPage) currentPage = 1;
            currentCategoryFilter = category;

            if(element) {
                document.querySelectorAll('.cat-item').forEach(el => el.classList.remove('active-menu'));
                element.classList.add('active-menu');
            }

            const savedIds = getSavedArticles();

            currentFilteredArticles = articles.filter(a => {
                const isPublished = a.status === 'published';
                let matchCat = true;
                if(category === 'Tersimpan') {
                    matchCat = savedIds.includes(a.id);
                } else {
                    matchCat = category === 'Semua' || a.category === category;
                }

                const matchQuery = query === '' || 
                                   a.title.toLowerCase().includes(query.toLowerCase()) || 
                                   a.tags.some(t => t.toLowerCase().includes(query.toLowerCase()));
                return isPublished && matchCat && matchQuery;
            });

            const totalPages = Math.ceil(currentFilteredArticles.length / ITEMS_PER_PAGE);
            if (!resetPage && currentPage > totalPages && totalPages > 0) {
                currentPage = 1;
            }

            renderPaginatedGrid();
            updateTrendingTags();
            updateTicker();
        }

        function renderPaginatedGrid() {
            const grid = document.getElementById('articlesGrid');
            grid.innerHTML = '';

            const start = (currentPage - 1) * ITEMS_PER_PAGE;
            const end = start + ITEMS_PER_PAGE;
            const pageData = currentFilteredArticles.slice(start, end);

            if(pageData.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1/-1; text-align:center; padding: 3rem; opacity:0.6; font-size:1.2rem;">Tidak ada artikel ditemukan.</div>';
                document.getElementById('paginationControls').innerHTML = '';
                return;
            }

            const savedIds = getSavedArticles();

            pageData.forEach(art => {
                const articleUrl = `${window.location.origin}${window.location.pathname}?article_id=${art.id}`;
                const shareText = encodeURIComponent(`Baca: "${art.title}"`);
                const shareUrlEncoded = encodeURIComponent(articleUrl);

                const isSaved = savedIds.includes(art.id);
                const bookmarkClass = isSaved ? 'fas' : 'far';
                
                const breakingClass = art.isBreaking ? 'breaking-news' : '';
                const breakingBadge = art.isBreaking ? '<div class="breaking-badge">BREAKING</div>' : '';

                const card = document.createElement('div'); card.className = `article-card-container ${breakingClass}`;
                card.innerHTML = `
                    <div class="article-card">
                        <button class="btn-bookmark-absolute ${isSaved ? 'active' : ''}" onclick="toggleBookmark(${art.id}, event)" title="Simpan Artikel">
                            <i class="${bookmarkClass} fa-bookmark"></i>
                        </button>

                        <div class="card-front">
                            ${breakingBadge}
                            <img src="${art.image}" class="card-img" alt="Cover" loading="lazy">
                            <div class="card-content">
                                <div class="card-header-top">
                                    <div class="card-cat">${art.category}</div>
                                </div>
                                <h3 class="card-title">${art.title}</h3>
                                <div class="card-meta">
                                    <span><i class="fas fa-user-circle"></i> ${art.author}</span>
                                    <span class="view-count"><i class="fas fa-eye"></i> ${art.views || 0}</span>
                                </div>
                            </div>
                        </div>
                        <div class="card-back">
                            <h3 style="font-size:1.1rem; margin-bottom:1rem;">${art.title}</h3>
                            <div class="share-buttons">
                                <a href="https://www.facebook.com/sharer/sharer.php?u=${shareUrlEncoded}" target="_blank" class="share-btn fb"><i class="fab fa-facebook-f"></i></a>
                                <a href="https://twitter.com/intent/tweet?text=${shareText}&url=${shareUrlEncoded}" target="_blank" class="share-btn tw"><i class="fab fa-twitter"></i></a>
                                <a href="https://wa.me/?text=${shareText} ${shareUrlEncoded}" target="_blank" class="share-btn wa"><i class="fab fa-whatsapp"></i></a>
                            </div>
                            <button class="btn btn-primary" onclick="openReadArticle(${art.id})" style="width:100%; justify-content:center;">Baca Selengkapnya</button>
                        </div>
                    </div>`;
                grid.appendChild(card);
            });

            renderPaginationControls();
        }

        function renderPaginationControls() {
            const totalPages = Math.ceil(currentFilteredArticles.length / ITEMS_PER_PAGE);
            const container = document.getElementById('paginationControls');
            container.innerHTML = '';

            if (totalPages <= 1) return;

            const prevBtn = document.createElement('button');
            prevBtn.className = 'btn btn-outline';
            prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
            prevBtn.onclick = () => changePage(currentPage - 1);
            if(currentPage === 1) prevBtn.disabled = true;
            container.appendChild(prevBtn);

            const pageInfo = document.createElement('span');
            pageInfo.className = 'page-info';
            pageInfo.innerText = `Hal ${currentPage} / ${totalPages}`;
            container.appendChild(pageInfo);

            const nextBtn = document.createElement('button');
            nextBtn.className = 'btn btn-outline';
            nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
            nextBtn.onclick = () => changePage(currentPage + 1);
            if(currentPage === totalPages) nextBtn.disabled = true;
            container.appendChild(nextBtn);
        }

        function changePage(newPage) {
            currentPage = newPage;
            renderPaginatedGrid();
            document.querySelector('main').scrollIntoView({ behavior: 'smooth' });
        }

        function updateTicker() {
            const breaking = articles.filter(a => a.status === 'published').slice(0,5);
            document.getElementById('tickerContent').innerHTML = breaking.map(a => `<div class="ticker-item" onclick="openReadArticle(${a.id})">${a.title}</div>`).join('');
        }

        function updateTrendingTags() {
            const trending = articles.filter(a => a.status === 'published')
                                     .sort((a,b) => (b.views || 0) - (a.views || 0))
                                     .slice(0, 8);
            
            document.getElementById('trendingTags').innerHTML = trending.map(a => 
                `<span class="tag" onclick="openReadArticle(${a.id})" style="font-size:0.8rem; display:block; margin-bottom:5px; text-overflow:ellipsis; overflow:hidden; white-space:nowrap;">
                 <i class="fas fa-chart-line"></i> ${a.title.substring(0,20)}... (${a.views || 0})
                 </span>`
            ).join('');
        }
        
        // --- TAHAP 2: AI FEATURES (Speech & Summary) ---
        let speechSynth = window.speechSynthesis;
        let speechUtterance = null;
        let isSpeaking = false;

        function speakContent(content) {
            if (isSpeaking) {
                speechSynth.cancel();
                isSpeaking = false;
                document.getElementById('aiSpeakBtn').innerHTML = '<i class="fas fa-volume-up"></i> Dengarkan Berita';
                document.querySelector('.speaking-animation').style.display = 'none';
                return;
            }

            const cleanText = content.replace(/<[^>]*>?/gm, ''); // Remove HTML
            speechUtterance = new SpeechSynthesisUtterance(cleanText);
            speechUtterance.lang = 'id-ID'; // Bahasa Indonesia
            speechUtterance.rate = 1;
            
            speechUtterance.onend = function() {
                isSpeaking = false;
                document.getElementById('aiSpeakBtn').innerHTML = '<i class="fas fa-volume-up"></i> Dengarkan Berita';
                document.querySelector('.speaking-animation').style.display = 'none';
            };

            speechSynth.speak(speechUtterance);
            isSpeaking = true;
            document.getElementById('aiSpeakBtn').innerHTML = '<i class="fas fa-stop-circle"></i> Stop Audio';
            document.querySelector('.speaking-animation').style.display = 'inline-block';
        }

        function simulateAISummary(content) {
            const summaryBox = document.getElementById('aiSummaryResult');
            const summaryContainer = document.querySelector('.ai-summary-box');
            summaryContainer.style.display = 'block';
            summaryBox.innerHTML = '<i class="fas fa-spinner fa-spin"></i> FerCy AI sedang berpikir...';

            setTimeout(() => {
                const cleanText = content.replace(/<[^>]*>?/gm, '');
                // Simple simulated summary: First 2 sentences
                const sentences = cleanText.match(/[^\.!\?]+[\.!\?]+/g) || [cleanText];
                const summary = sentences.slice(0, 3).join(' ');
                
                summaryBox.innerHTML = `
                    <p><strong>Ringkasan Cepat:</strong></p>
                    <p>${summary}</p>
                    <small style="color:var(--text-muted)">*Diringkas otomatis oleh FerCy AI (Beta)</small>
                `;
            }, 1500); // Simulate API delay
        }

        function openReadArticle(id) {
            const art = articles.find(a => a.id == id); if(!art) return;
            
            articlesRef.child(id).child('views').transaction((currentViews) => {
                return (currentViews || 0) + 1;
            });

            // Update URL
            const newUrl = window.location.pathname + '?article_id=' + id;
            window.history.pushState({path: newUrl}, '', newUrl);
            
            // --- UPDATE 1: JUDUL HALAMAN ---
            document.title = art.title + " - FerCy News ID"; 

            // --- UPDATE 2: META TAGS (DINAMIS VIA JS) ---
            // Membersihkan tag HTML dari konten untuk deskripsi
            const cleanDesc = art.content.replace(/<[^>]*>?/gm, '').substring(0, 150) + '...';
            
            // Update Open Graph (FB/WA/IG)
            document.getElementById('ogTitle').setAttribute('content', art.title);
            document.getElementById('ogDesc').setAttribute('content', cleanDesc);
            document.getElementById('ogImage').setAttribute('content', art.image);
            document.getElementById('ogUrl').setAttribute('content', window.location.href);

            // Update Twitter Cards
            document.getElementById('twTitle').setAttribute('content', art.title);
            document.getElementById('twDesc').setAttribute('content', cleanDesc);
            document.getElementById('twImage').setAttribute('content', art.image);

            const breakingBadge = art.isBreaking ? '<span style="background:var(--danger); color:white; padding:4px 8px; border-radius:4px; font-size:0.8rem; margin-right:10px;">BREAKING</span>' : '';

            // TAHAP 2: Inject AI Tools & Layout
            document.getElementById('readContentContainer').innerHTML = `
                <div class="read-header"><img src="${art.image}" class="read-cover"></div>
                <div class="read-body">
                    <div style="display:flex; align-items:center; margin-bottom:1rem;">
                        ${breakingBadge}
                        <span style="color:var(--secondary); font-weight:700; text-transform:uppercase; letter-spacing:1px; font-size:0.9rem;">${art.category}</span>
                    </div>
                    <h1>${art.title}</h1>
                    <div class="read-meta">
                        <span>Ditulis oleh <strong>${art.author}</strong> pada ${art.date}</span>
                        <span><i class="fas fa-eye"></i> ${art.views || 0} Views</span>
                    </div>

                    <div class="ai-tools-container">
                        <button id="aiSpeakBtn" class="btn btn-ai" onclick="speakContent(\`${art.content.replace(/`/g, "\\`").replace(/"/g, "&quot;")}\`)">
                            <i class="fas fa-volume-up"></i> Dengarkan Berita
                        </button>
                        <button class="btn btn-outline" onclick="simulateAISummary(\`${art.content.replace(/`/g, "\\`").replace(/"/g, "&quot;")}\`)">
                            <i class="fas fa-magic"></i> Ringkas dengan AI
                        </button>
                        
                        <div class="text-control-box">
                            <button class="tc-btn" onclick="adjustFontSize(-1)" title="Perkecil Teks"><i class="fas fa-minus"></i> A</button>
                            <div class="tc-divider"></div>
                            <button class="tc-btn" onclick="adjustFontSize(1)" title="Perbesar Teks">A <i class="fas fa-plus"></i></button>
                            <div class="tc-divider"></div>
                            <button class="tc-btn" onclick="resetFontSize()" title="Reset"><i class="fas fa-redo"></i></button>
                        </div>

                        <div class="speaking-animation"></div>
                    </div>
                    
                    <div class="ai-summary-box">
                        <h4><i class="fas fa-robot"></i> FerCy AI Insight</h4>
                        <div id="aiSummaryResult"></div>
                    </div>
                    <div class="read-content ql-editor">${art.content}</div>
                    
                    <div style="margin-top:3rem; padding-top:1rem; border-top:1px solid rgba(255,255,255,0.1);">
                        <strong>Tags:</strong> ${art.tags.map(t => `<span class="tag">${t}</span>`).join(' ')}
                    </div>
                    <div class="comments-section" style="margin-top:3rem;">
                        <div style="font-size:1.2rem; font-weight:700; margin-bottom:1rem;"><i class="far fa-comments"></i> Komentar</div>
                        <div id="disqus_thread"></div>
                    </div>
                </div>`;
            
            document.getElementById('readModal').style.display = 'block';

            // --- UPDATE: Tampilkan UX Reading Controls ---
            document.getElementById('readProgressBar').style.display = 'block';
            resetFontSize(); // Reset font setiap buka artikel baru

            if (typeof DISQUS !== 'undefined') {
                DISQUS.reset({
                    reload: true,
                    config: function () {
                        this.page.identifier = art.id;
                        this.page.url = window.location.href; 
                        this.page.title = art.title;
                    }
                });
            } else {
                var d = document, s = d.createElement('script');
                s.src = 'https://fercynews-demo.disqus.com/embed.js'; 
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            }
        }

        function closeReadModal() { 
            // Stop speech if playing
            if(speechSynth) speechSynth.cancel();
            isSpeaking = false;

            document.getElementById('readModal').style.display = 'none'; 
            
            // --- UPDATE: Sembunyikan UX Reading Controls ---
            document.getElementById('readProgressBar').style.display = 'none';
            // document.getElementById('textControls').style.display = 'none'; // REMOVED: Sudah tidak pakai ID ini

            // Clean URL
            const cleanUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
            window.history.replaceState({ path: cleanUrl }, '', cleanUrl);

            // --- UPDATE 3: RESET META TAGS KE DEFAULT ---
            document.title = "FerCy News ID Portal"; 
            
            // Reset OG
            document.getElementById('ogTitle').setAttribute('content', 'FerCy News ID Portal');
            document.getElementById('ogDesc').setAttribute('content', 'Portal Berita Lingkungan dan Teknologi Terkini');
            document.getElementById('ogImage').setAttribute('content', 'https://cdn-icons-png.flaticon.com/512/2965/2965879.png');
            document.getElementById('ogUrl').setAttribute('content', cleanUrl);

            // Reset Twitter
            document.getElementById('twTitle').setAttribute('content', 'FerCy News ID Portal');
            document.getElementById('twDesc').setAttribute('content', 'Portal Berita Lingkungan dan Teknologi Terkini');
            document.getElementById('twImage').setAttribute('content', 'https://cdn-icons-png.flaticon.com/512/2965/2965879.png');

            refreshAllData();
        }

        function handleSearch() {
            const q = document.getElementById('searchInput').value;
            filterArticlesByQueryAndCategory(q, 'Semua');
        }

        function filterByCategory(c, el) {
            document.getElementById('searchInput').value = ''; 
            filterArticlesByQueryAndCategory('', c, true, el);
        }

        function searchByTag(t) {
            document.getElementById('searchInput').value = t;
            filterArticlesByQueryAndCategory(t, 'Semua');
        }

        window.onscroll = function() {
            const btn = document.getElementById("scrollTopBtn");
            if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                btn.style.display = "flex";
            } else {
                btn.style.display = "none";
            }
        };
        function scrollToTop() { document.body.scrollTop = 0; document.documentElement.scrollTop = 0; }

        function openWriteModal() { 
            document.getElementById('articleForm').reset();
            document.getElementById('postId').value = "";
            document.getElementById('targetStatus').value = "pending";
            quill.root.innerHTML = "";
            
            // Reset image inputs
            toggleImageInput('upload');

            if(isAdmin) {
                document.getElementById('userButtons').style.display = 'none';
                document.getElementById('adminButtons').style.display = 'flex';
            } else {
                document.getElementById('userButtons').style.display = 'block';
                document.getElementById('adminButtons').style.display = 'none';
            }
            document.getElementById('writeModal').style.display = 'block'; 
        }

        function closeWriteModal() { document.getElementById('writeModal').style.display = 'none'; }
        function openLoginModal() { document.getElementById('loginModal').style.display = 'block'; }
        function closeLoginModal() { document.getElementById('loginModal').style.display = 'none'; }
        function openPedomanModal() { document.getElementById('pedomanModal').style.display = 'block'; }
        function closePedomanModal() { document.getElementById('pedomanModal').style.display = 'none'; }
        window.onclick = e => { if(e.target.className === 'modal') e.target.style.display = 'none'; };

        // --- UPDATE TAHAP 2 (POIN 3): READING UX FUNCTIONS ---

        // 1. Reading Progress Logic
        function updateReadProgress() {
            const modal = document.getElementById('readModal');
            const scrollTop = modal.scrollTop;
            const scrollHeight = modal.scrollHeight;
            const clientHeight = modal.clientHeight;
            
            // Hitung persentase scroll
            const scrolled = (scrollTop / (scrollHeight - clientHeight)) * 100;
            document.getElementById('progressBarFill').style.width = scrolled + "%";
        }

        // 2. Text Size Control Logic
        let currentFontSize = 16; // Ukuran default (px)

        function adjustFontSize(amount) {
            currentFontSize += amount;
            // Batasi ukuran min 12px dan max 24px
            if(currentFontSize < 12) currentFontSize = 12;
            if(currentFontSize > 24) currentFontSize = 24;
            
            applyFontSize();
        }

        function resetFontSize() {
            currentFontSize = 16;
            applyFontSize();
        }

        function applyFontSize() {
            // Targetkan area konten artikel
            const contentArea = document.querySelector('.read-content');
            if(contentArea) {
                contentArea.style.fontSize = currentFontSize + "px";
                contentArea.style.lineHeight = (currentFontSize * 1.6) + "px"; // Sesuaikan spasi baris
            }
        }

        // --- TAHAP 2: SERVICE WORKER REGISTRATION (PERFORMANCE) ---
        if ('serviceWorker' in navigator) {
            const swContent = `
                const CACHE_NAME = 'fercy-news-v2';
                const urlsToCache = [
                    '/',
                    'https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@300;400;500;600;700;800&display=swap',
                    'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css',
                    'https://cdn.quilljs.com/1.3.6/quill.snow.css',
                    'https://cdn.quilljs.com/1.3.6/quill.js'
                ];
                self.addEventListener('install', event => {
                    event.waitUntil(caches.open(CACHE_NAME).then(cache => cache.addAll(urlsToCache)));
                });
                self.addEventListener('fetch', event => {
                    event.respondWith(caches.match(event.request).then(response => response || fetch(event.request)));
                });
            `;
            const blob = new Blob([swContent], {type: 'application/javascript'});
            const swUrl = URL.createObjectURL(blob);
            navigator.serviceWorker.register(swUrl)
                .then(reg => console.log('ServiceWorker registered', reg))
                .catch(err => console.log('ServiceWorker failed', err));
        }
    </script>
</body>
</html>
